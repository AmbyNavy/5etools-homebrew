const _0x5046be=_0x1807;(function(_0x3eede8,_0x2505eb){const _0x3b53b7=_0x1807,_0x1434d0=_0x3eede8();while(!![]){try{const _0x38e248=-parseInt(_0x3b53b7(0x1da))/0x1*(parseInt(_0x3b53b7(0x1f0))/0x2)+-parseInt(_0x3b53b7(0x1f1))/0x3+parseInt(_0x3b53b7(0x1c8))/0x4+-parseInt(_0x3b53b7(0x1dd))/0x5*(-parseInt(_0x3b53b7(0x1c2))/0x6)+parseInt(_0x3b53b7(0x1c9))/0x7+parseInt(_0x3b53b7(0x1ec))/0x8*(-parseInt(_0x3b53b7(0x1d2))/0x9)+parseInt(_0x3b53b7(0x1e8))/0xa;if(_0x38e248===_0x2505eb)break;else _0x1434d0['push'](_0x1434d0['shift']());}catch(_0x585737){_0x1434d0['push'](_0x1434d0['shift']());}}}(_0x553f,0x7cb62));import{SharedConsts}from'../shared/SharedConsts.js';import{Config}from'./Config.js';import{Menu}from'./Menu.js';import{UtilApplications}from'./UtilApplications.js';function _0x1807(_0x3497b2,_0x8e8b84){const _0x553f20=_0x553f();return _0x1807=function(_0x18075d,_0x23e091){_0x18075d=_0x18075d-0x1c2;let _0x5077d2=_0x553f20[_0x18075d];return _0x5077d2;},_0x1807(_0x3497b2,_0x8e8b84);}import{PopoutSheet}from'./PopoutSheet.js';function _0x553f(){const _0x4d375c=['closeAllMenus','keybindings','KEYBINDING_PRECEDENCE','ready','LIBWRAPPER_MODE_WRAPPER','.configUpdate','target','game.keyboard.hasFocus','Escape','30sDeERC','event','nodeName','isFixEscapeKey','keys','_pHandleConfigUpdate','3459384OVKPZj','2569371MeSZeU','game.keyboard._handleKeyboardEvent','register','isPoppedOut','last','display','pLock','length','PRIORITY','854622VQLbtF','TEXTAREA','releaseAll','preview','filter','preventDefault','get','init','6577UDnIHh','saveFog','_ELEMENTS_WITH_FOCUS','445705KCuenn','_LAST_KEYBOARD_EVENT_INFO','values','_pHandleConfigUpdate_','sight','children','element','windows','_MODAL_STACK','style','close','9684610dIZsCL','context','activeLayer','_ACTION_DISMISS','56MdoaoF','isEscapeable','MODULE_NAME','set','244UNucjS','2004441yjBNKz','_LOCK_EDIT_KEYBINDS','MODULE_NAME_FAKE','unlock','_init_registerKeybindEsc','menu'];_0x553f=function(){return _0x4d375c;};return _0x553f();}import{libWrapper,UtilLibWrapper}from'./PatcherLibWrapper.js';class Patcher_GameKeyboard{static['preInit'](){const _0x1a4b06=_0x1807;this[_0x1a4b06(0x1f5)]();}static[_0x5046be(0x1d9)](){const _0x41a8e2=_0x5046be;Hooks['on'](SharedConsts[_0x41a8e2(0x1f3)]+_0x41a8e2(0x1fc),()=>this[_0x41a8e2(0x1c7)]()),this['_pHandleConfigUpdate'](),this['_init_patchEscapeMethods']();}static['_init_patchEscapeMethods'](){const _0x2d9857=_0x5046be;libWrapper[_0x2d9857(0x1cb)](SharedConsts[_0x2d9857(0x1ee)],_0x2d9857(0x1ca),function(_0x33d4d0,..._0x57ada){const _0x461270=_0x33d4d0(..._0x57ada);return Patcher_GameKeyboard['_LAST_KEYBOARD_EVENT_INFO']={'event':_0x57ada[0x0],'isUp':_0x57ada[0x1]},_0x461270;},UtilLibWrapper[_0x2d9857(0x1fb)]),libWrapper[_0x2d9857(0x1cb)](SharedConsts['MODULE_NAME'],_0x2d9857(0x1fe),function(_0x153394,..._0x34f431){const _0x46e626=_0x2d9857,_0x1a6084=_0x153394(..._0x34f431);if(!Config[_0x46e626(0x1d8)]('ui',_0x46e626(0x1c5)))return _0x1a6084;if(Patcher_GameKeyboard['_LAST_KEYBOARD_EVENT_INFO']?.[_0x46e626(0x1c3)]?.['key']!==_0x46e626(0x1ff))return _0x1a6084;return![];},UtilLibWrapper[_0x2d9857(0x1fb)]);}static async[_0x5046be(0x1c7)](){const _0x5c42f3=_0x5046be;try{await Patcher_GameKeyboard['_LOCK_EDIT_KEYBINDS'][_0x5c42f3(0x1cf)](),await this['_pHandleConfigUpdate_']();}finally{Patcher_GameKeyboard[_0x5c42f3(0x1f2)][_0x5c42f3(0x1f4)]();}}static async[_0x5046be(0x1e0)](){const _0x79fc68=_0x5046be;game[_0x79fc68(0x1f8)][_0x79fc68(0x1ef)](SharedConsts[_0x79fc68(0x1ee)],Patcher_GameKeyboard[_0x79fc68(0x1eb)]);if(!Config[_0x79fc68(0x1d8)]('ui',_0x79fc68(0x1c5)))return;game['keybindings']['set'](SharedConsts[_0x79fc68(0x1ee)],Patcher_GameKeyboard['_ACTION_DISMISS'],[{'key':_0x79fc68(0x1ff)}]);}static[_0x5046be(0x1f5)](){const _0x571038=_0x5046be;game[_0x571038(0x1f8)][_0x571038(0x1cb)](SharedConsts[_0x571038(0x1ee)],Patcher_GameKeyboard[_0x571038(0x1eb)],{'name':'KEYBINDINGS.Dismiss','hint':'An\x20improved\x20version\x20of\x20Foundry\x27s\x20built-in\x20binding.\x20Bind\x20the\x20\x22Escape\x22\x20key\x20to\x20(in\x20this\x20order):\x20de-select\x20active\x20input\x20fields;\x20de-select\x20selected\x20canvas\x20elements;\x20close\x20context\x20menus;\x20close\x20individual\x20windows\x20in\x20most-recently-active-first\x20order;\x20toggle\x20the\x20main\x20menu.','onDown':_0x47e9c1=>{const _0x3dde51=_0x571038,{event:_0x559dba}=_0x47e9c1;if(UiUtil['_MODAL_STACK']&&UiUtil[_0x3dde51(0x1e5)][_0x3dde51(0x1d0)])return!![];if(ui['menu'][_0x3dde51(0x1e3)]&&ui[_0x3dde51(0x1f6)][_0x3dde51(0x1e3)]?.[0x0]?.[_0x3dde51(0x1e6)]?.[_0x3dde51(0x1ce)]==='')return ui[_0x3dde51(0x1f6)]['toggle'](),!![];if(document['hasFocus']()&&Patcher_GameKeyboard[_0x3dde51(0x1dc)]['has'](_0x559dba[_0x3dde51(0x1fd)][_0x3dde51(0x1c4)]))return _0x559dba[_0x3dde51(0x1fd)]['blur'](),!![];if(canvas[_0x3dde51(0x1fa)])canvas[_0x3dde51(0x1e1)][_0x3dde51(0x1db)]();if(ui[_0x3dde51(0x1e9)]&&ui[_0x3dde51(0x1e9)][_0x3dde51(0x1f6)]['length'])ui[_0x3dde51(0x1e9)][_0x3dde51(0x1e7)]();else{if(Menu[_0x3dde51(0x1f7)]())return!![];else{if(canvas['ready']&&Object[_0x3dde51(0x1c6)](canvas[_0x3dde51(0x1ea)]?.['_controlled']||{})[_0x3dde51(0x1d0)]){_0x559dba[_0x3dde51(0x1d7)]();if(!canvas[_0x3dde51(0x1ea)][_0x3dde51(0x1d5)]?.[_0x3dde51(0x1e2)]['length'])canvas[_0x3dde51(0x1ea)][_0x3dde51(0x1d4)]();}else{if(Object[_0x3dde51(0x1df)](ui[_0x3dde51(0x1e4)])[_0x3dde51(0x1d6)](_0x6ade12=>(_0x6ade12[_0x3dde51(0x1ed)]==null||_0x6ade12[_0x3dde51(0x1ed)]===!![])&&!PopoutSheet[_0x3dde51(0x1cc)](_0x6ade12))[_0x3dde51(0x1d0)])UtilApplications['getOpenAppsSortedByZindex']()[_0x3dde51(0x1d6)](_0x23a83d=>(_0x23a83d[_0x3dde51(0x1ed)]==null||_0x23a83d[_0x3dde51(0x1ed)]===!![])&&!PopoutSheet[_0x3dde51(0x1cc)](_0x23a83d))[_0x3dde51(0x1cd)]()[_0x3dde51(0x1e7)]();else ui[_0x3dde51(0x1f6)]['toggle']();}}}return!![];},'restricted':![],'precedence':CONST[_0x571038(0x1f9)][_0x571038(0x1d1)]});}}Patcher_GameKeyboard[_0x5046be(0x1eb)]='KEYBINDINGS.Dismiss',Patcher_GameKeyboard[_0x5046be(0x1dc)]=new Set(['INPUT',_0x5046be(0x1d3)]),Patcher_GameKeyboard[_0x5046be(0x1f2)]=new VeLock(),Patcher_GameKeyboard[_0x5046be(0x1de)]=null;export{Patcher_GameKeyboard};