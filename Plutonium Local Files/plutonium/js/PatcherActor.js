const _0x59997d=_0x592e;(function(_0x4745fa,_0x162f1c){const _0x43d50b=_0x592e,_0xb01279=_0x4745fa();while(!![]){try{const _0x3f60fb=parseInt(_0x43d50b(0x133))/0x1+-parseInt(_0x43d50b(0x128))/0x2+parseInt(_0x43d50b(0xf1))/0x3*(-parseInt(_0x43d50b(0x108))/0x4)+-parseInt(_0x43d50b(0x105))/0x5*(parseInt(_0x43d50b(0x101))/0x6)+parseInt(_0x43d50b(0x112))/0x7*(parseInt(_0x43d50b(0x142))/0x8)+parseInt(_0x43d50b(0x121))/0x9+parseInt(_0x43d50b(0x11d))/0xa;if(_0x3f60fb===_0x162f1c)break;else _0xb01279['push'](_0xb01279['shift']());}catch(_0x37f824){_0xb01279['push'](_0xb01279['shift']());}}}(_0x4734,0xd51a1));function _0x592e(_0x19a240,_0x24736a){const _0x473406=_0x4734();return _0x592e=function(_0x592eea,_0x3d6c3a){_0x592eea=_0x592eea-0xee;let _0x3bf722=_0x473406[_0x592eea];return _0x3bf722;},_0x592e(_0x19a240,_0x24736a);}import{libWrapper,UtilLibWrapper}from'./PatcherLibWrapper.js';function _0x4734(){const _0xd6b768=['892362FTqNwd','LIBWRAPPER_MODE_WRAPPER','render','getRollData','reduce','\x20active\x20effects','\x22\x20(\x22','\x22\x20in\x20expression\x20\x22','tree','CONFIG.Actor.documentClass.prototype.getRollData','actor','1135031lmYmit','getKeyFromCustomKey','boolean','sort','get','_init_tryPatchGetRollData','last','forEach','number','addBabeleCompatibilityRollData','\x22\x20(','name','Unhandled\x20custom\x20active\x20effect\x20key:\x20','error','handleHookApplyActiveEffect','8wZswZU','string','replace','_getRollData','array','changes','effects','concat','MODULE_NAME','sheet','3tSnpUt','getAdditionalRollDataBase','isUseExtendedActiveEffectsParser','instance','length','dice','object','evl','copy','warn','\x22\x20with\x20roll\x20data\x20applied)\x20in\x20actor\x20(','HK_CONFIG_UPDATE','path','isDebug','utils','apply','6874344iqwxfg','element','Failed\x20to\x20resolve\x20attribute\x20\x22','expandObject','5cpDpJN','map','_applyActiveEffects','5929348RnmIeN','register','_applyActiveEffects_mutValues','isSuppressed','prepareData','MODULE_NAME_FAKE','getProperty','mode','assign','_applyActiveEffects_getFullRollData','2024687OlvSit','_handleConfigUpdate','data','Actor','collection','_init_tryPatchApplyActiveEffects','data.attributes.ac.flat','priority','duplicate','key','Failed\x20to\x20bind\x20getRollData\x20handler!','9602360HeAbGO','size','getTree3','contents','14063391JoqoFs','lang','value','disabled','overrides','LIBWRAPPER_MODE_MIXED','effect'];_0x4734=function(){return _0xd6b768;};return _0x4734();}import{SharedConsts}from'../shared/SharedConsts.js';import{Config}from'./Config.js';import{UtilActiveEffects}from'./UtilActiveEffects.js';import{LGT,Util}from'./Util.js';import{Patcher_RollData}from'./PatcherRollData.js';import{UtilHooks}from'./UtilHooks.js';class Patcher_Actor{static['init'](){const _0x1b32c8=_0x592e;this[_0x1b32c8(0x138)](),this[_0x1b32c8(0x117)]();}static['_init_tryPatchGetRollData'](){const _0x55d58a=_0x592e;try{libWrapper[_0x55d58a(0x109)](SharedConsts[_0x55d58a(0xef)],_0x55d58a(0x131),function(_0x2e290c,..._0x4974f9){const _0x6393fb=_0x55d58a,_0x562613=_0x2e290c(..._0x4974f9);return Patcher_Actor[_0x6393fb(0x145)](this,_0x562613);},UtilLibWrapper[_0x55d58a(0x129)]);}catch(_0x489966){console[_0x55d58a(0x140)](...LGT,_0x55d58a(0x11c),_0x489966);}}static[_0x59997d(0x145)](_0x1b0929,_0x2a84bd){const _0x1ab2e7=_0x59997d;if(!_0x2a84bd)return _0x2a84bd;return Object[_0x1ab2e7(0x110)](_0x2a84bd,Patcher_RollData[_0x1ab2e7(0xf2)](_0x1b0929)),Patcher_RollData[_0x1ab2e7(0x13c)](_0x2a84bd,_0x1b0929),_0x2a84bd;}static[_0x59997d(0x117)](){const _0x3e2e4f=_0x59997d;libWrapper[_0x3e2e4f(0x109)](SharedConsts[_0x3e2e4f(0xef)],'Actor.prototype.applyActiveEffects',function(_0x548762,..._0x1e2672){const _0x206da2=_0x3e2e4f;if(!Config[_0x206da2(0x137)](_0x206da2(0x132),_0x206da2(0xf3)))return _0x548762(..._0x1e2672);return Patcher_Actor[_0x206da2(0x107)](this,..._0x1e2672);},UtilLibWrapper[_0x3e2e4f(0x126)]),UtilHooks['on'](UtilHooks[_0x3e2e4f(0xfc)],()=>this[_0x3e2e4f(0x113)]());}static['_handleConfigUpdate'](){const _0x149b69=_0x59997d;CONFIG['Actor'][_0x149b69(0x116)][_0x149b69(0xf4)][_0x149b69(0x120)][_0x149b69(0x13a)](_0x2b54d6=>{const _0x507806=_0x149b69;_0x2b54d6[_0x507806(0x10c)]();if(_0x2b54d6[_0x507806(0xf0)]?.[_0x507806(0x102)]?.[_0x507806(0xf5)])_0x2b54d6[_0x507806(0xf0)][_0x507806(0x12a)]();});}static['_applyActiveEffects'](_0x3c3dfd){const _0x15b706=_0x59997d;if(!_0x3c3dfd[_0x15b706(0x148)]||!_0x3c3dfd[_0x15b706(0x148)][_0x15b706(0x11e)]&&!_0x3c3dfd['effects']['length'])return;const _0x4ddef2={},_0x355bf2=_0x3c3dfd['effects'][_0x15b706(0x12c)]((_0xdd0ff8,_0x9dafe4)=>{const _0x341501=_0x15b706;if(_0x9dafe4[_0x341501(0x114)][_0x341501(0x124)]||_0x9dafe4[_0x341501(0x10b)])return _0xdd0ff8;return _0xdd0ff8[_0x341501(0xee)](_0x9dafe4['data'][_0x341501(0x147)][_0x341501(0x106)](_0x1e80a2=>{const _0x56b55b=_0x341501;return _0x1e80a2=foundry[_0x56b55b(0xff)][_0x56b55b(0x11a)](_0x1e80a2),_0x1e80a2[_0x56b55b(0x127)]=_0x9dafe4,_0x1e80a2[_0x56b55b(0x119)]=_0x1e80a2['priority']??_0x1e80a2[_0x56b55b(0x10f)]*0xa,_0x1e80a2;}));},[]);_0x355bf2[_0x15b706(0x136)]((_0x216859,_0x322645)=>_0x216859[_0x15b706(0x119)]-_0x322645[_0x15b706(0x119)]),Patcher_Actor[_0x15b706(0x10a)](_0x3c3dfd,_0x355bf2);for(let _0x33673d of _0x355bf2){const _0x31c0ef=_0x33673d['effect'][_0x15b706(0x100)](_0x3c3dfd,_0x33673d);if(_0x31c0ef!==null)_0x4ddef2[_0x33673d[_0x15b706(0x11b)]]=_0x31c0ef;}_0x3c3dfd[_0x15b706(0x125)]=foundry[_0x15b706(0xff)][_0x15b706(0x104)](_0x4ddef2);}static[_0x59997d(0x10a)](_0xa23305,_0xeeb700){const _0x426a2e=_0x59997d;if(!_0xeeb700[_0x426a2e(0xf5)])return;let _0x4f22d7;const _0x2c2a09=UtilActiveEffects['getAvailableEffectsLookup'](_0xa23305,{'isActorEffect':!![]});_0xeeb700['forEach'](_0x4699d3=>{const _0xc8da26=_0x426a2e;if(typeof _0x4699d3[_0xc8da26(0x123)]!==_0xc8da26(0x143))return;const _0x197f4c=UtilActiveEffects['getActiveEffectType'](_0x2c2a09,_0x4699d3[_0xc8da26(0x11b)]);switch(_0x197f4c){case _0xc8da26(0xf7):case _0xc8da26(0x146):{try{_0x4699d3[_0xc8da26(0x123)]=eval(_0x4699d3[_0xc8da26(0x123)]);}catch(_0x20520f){if(Util['isDebug']())console[_0xc8da26(0x140)](...LGT,_0x20520f);}break;}case undefined:case null:case'null':case _0xc8da26(0x13b):case'boolean':{if(!_0x4f22d7)_0x4f22d7=Patcher_Actor['_applyActiveEffects_getFullRollData'](_0xa23305);try{_0x4699d3[_0xc8da26(0x123)]=this['_getEvaluatedExpression'](_0xa23305,_0x4699d3['value'],_0x4f22d7);if(_0x197f4c===_0xc8da26(0x135))_0x4699d3[_0xc8da26(0x123)]=!!_0x4699d3[_0xc8da26(0x123)];}catch(_0xcaf2e9){if(Util[_0xc8da26(0xfe)]())console[_0xc8da26(0x140)](...LGT,_0xcaf2e9);}break;}case _0xc8da26(0x143):case'undefined':default:break;}});}static['_getEvaluatedExpression'](_0x3e3e63,_0x51e274,_0x24f706){const _0x5d3266=_0x59997d,_0xfa3692=_0x51e274[_0x5d3266(0x144)](/@(?<path>[a-zA-Z0-9.]+)/g,(..._0x53f672)=>{const _0x2f25f6=_0x5d3266,_0x319e92=foundry[_0x2f25f6(0xff)][_0x2f25f6(0x10e)](_0x24f706,_0x53f672[_0x2f25f6(0x139)]()[_0x2f25f6(0xfd)]);if(_0x319e92===undefined)return console['warn'](...LGT,_0x2f25f6(0x103)+_0x53f672['last']()[_0x2f25f6(0xfd)]+_0x2f25f6(0x12f)+_0x51e274+'\x22\x20for\x20actor\x20\x22'+_0x3e3e63[_0x2f25f6(0x13e)]+_0x2f25f6(0x13d)+_0x3e3e63['id']+')'),0x0;return _0x319e92;})[_0x5d3266(0x144)](/\btrue\b/g,0x1)[_0x5d3266(0x144)](/\bfalse\b/g,0x0)['replace'](/\bnull\b/g,0x0);let _0x35861b;try{_0x35861b=Renderer[_0x5d3266(0xf6)][_0x5d3266(0x122)][_0x5d3266(0x11f)](_0xfa3692,![]);}catch(_0x182e97){return console[_0x5d3266(0xfa)](...LGT,'Failed\x20to\x20parse\x20expression\x20\x22'+_0x51e274+_0x5d3266(0x12e)+_0xfa3692+_0x5d3266(0xfb)+_0x3e3e63[_0x5d3266(0x13e)]+')\x20'+_0x3e3e63['id']+_0x5d3266(0x12d),_0x182e97['message']),0x0;}return _0x35861b[_0x5d3266(0x130)][_0x5d3266(0xf8)]({});}static[_0x59997d(0x111)](_0x3c1590){const _0xe7e09f=_0x59997d,_0xf1bc22=MiscUtil[_0xe7e09f(0xf9)](_0x3c1590[_0xe7e09f(0x114)]);_0xf1bc22[_0xe7e09f(0x148)]=[];const _0x5592b1=new CONFIG[(_0xe7e09f(0x115))]['documentClass']({..._0xf1bc22});return _0x5592b1['prepareData'](),_0x5592b1[_0xe7e09f(0x12b)]();}static[_0x59997d(0x141)](_0x2c1ca8,_0x55df19){const _0xd16ea=_0x59997d;if(!Config[_0xd16ea(0x137)](_0xd16ea(0x132),_0xd16ea(0xf3)))return;if(!(_0x55df19[_0xd16ea(0x11b)]||'')['startsWith'](SharedConsts[_0xd16ea(0x10d)]))return;const _0x49ee54=UtilActiveEffects[_0xd16ea(0x134)](_0x55df19[_0xd16ea(0x11b)]);switch(_0x49ee54){case _0xd16ea(0x118):{const {value:_0x29251e}=_0x55df19,_0x461fb0=foundry['utils'][_0xd16ea(0x10e)](_0x2c1ca8[_0xd16ea(0x114)],_0x49ee54);if(typeof _0x461fb0===_0xd16ea(0x13b)&&_0x461fb0>=Number(_0x29251e))return null;setProperty(_0x2c1ca8[_0xd16ea(0x114)],_0x49ee54,_0x29251e);return;}default:console['warn'](...LGT,_0xd16ea(0x13f)+_0x49ee54);}}}export{Patcher_Actor};