const _0x4eafc6=_0x1d5b;function _0x424c(){const _0x26c5a8=['val','actor','dice','userId','tokenId','data','18ngRFkI','instance','collection','groups','get','getDisplayCurrency','<div>Currency:\x20','./LootGeneratorApp.js','doShowImportedNotification','Received\x20Rivet\x20message\x20(JSON)','remove','Unhandled\x20Rivet\x20message\x20with\x20type\x20\x22','_handleRollMessage','rolledBy','role','Actor','type','currency','402880RmfKwR','ROLL','\x22\x20to\x20actor\x20\x22','567976EIdVKg','init','3654126pgfwRR','2laTyzB','minimumRole','tokens','isWhisper','exec','TASK_EXIT_FAILED','160766FNPxQx','rivet','filter','__prop','1921927AdWUDT','getImporter','settings','_pHandleEntityMessage','\x22!\x20You\x20may\x20need\x20to\x20update\x20your\x20extension.','WHISPER','rivet.receive','CHAT_MESSAGE_TYPES','_handlePacket','toMessage','import','Received\x20Rivet\x20message\x20(text)','_getTargetActor','pAddCurrencyToActor','roll','page','4840490tqwqfg','error','5etools.blacklist.excludes','isTemp','user','Rivet','label','isGM','pInit','5etools.lootgen.loot','44DQXxes','entity','notifications','</div>','name','options','1084989PVxsOE','create','users','last','pSaveState','_pHandleCurrencyMessage','Failed\x20to\x20apply\x20currency\x20\x22','_pHandleSpecialMessage_5etools_blacklist_excludes','contents','addEventListener'];_0x424c=function(){return _0x26c5a8;};return _0x424c();}(function(_0x3d6c91,_0x242dcd){const _0x549c7c=_0x1d5b,_0xf75851=_0x3d6c91();while(!![]){try{const _0x21379b=parseInt(_0x549c7c(0xde))/0x1+-parseInt(_0x549c7c(0xd8))/0x2*(-parseInt(_0x549c7c(0x102))/0x3)+parseInt(_0x549c7c(0xfc))/0x4*(parseInt(_0x549c7c(0xd2))/0x5)+-parseInt(_0x549c7c(0xd7))/0x6+parseInt(_0x549c7c(0xe2))/0x7+-parseInt(_0x549c7c(0xd5))/0x8*(parseInt(_0x549c7c(0x112))/0x9)+-parseInt(_0x549c7c(0xf2))/0xa;if(_0x21379b===_0x242dcd)break;else _0xf75851['push'](_0xf75851['shift']());}catch(_0x281ceb){_0xf75851['push'](_0xf75851['shift']());}}}(_0x424c,0x6d706));function _0x1d5b(_0x418143,_0x597682){const _0x424c18=_0x424c();return _0x1d5b=function(_0x1d5b09,_0x41d50b){_0x1d5b09=_0x1d5b09-0xc4;let _0x14f94a=_0x424c18[_0x1d5b09];return _0x14f94a;},_0x1d5b(_0x418143,_0x597682);}import{Config}from'./Config.js';import{LGT}from'./Util.js';import{UtilApplications}from'./UtilApplications.js';import{ActorCharactermancerSourceSelector}from'./ActorCharactermancer.js';import{UtilActors}from'./UtilActors.js';import{UtilWorldContentBlacklist}from'./UtilWorldContentBlacklist.js';class RivetBridge{static[_0x4eafc6(0xd6)](){const _0x26fd7f=_0x4eafc6;window[_0x26fd7f(0x10b)](_0x26fd7f(0xe8),_0x587ebf=>{const _0x4dd6df=_0x26fd7f;return console['log'](...LGT,_0x4dd6df(0xc9)),this['_handlePacket'](_0x587ebf['detail']);}),window[_0x26fd7f(0x10b)]('rivet.receive-text',()=>{const _0x1c8bda=_0x26fd7f;console['log'](...LGT,_0x1c8bda(0xed));const _0x48b6e4=$('textarea.rivet-transfer'),_0x49760c=_0x48b6e4[_0x1c8bda(0x105)]()[_0x1c8bda(0x10c)]();return _0x48b6e4[_0x1c8bda(0xca)](),this[_0x1c8bda(0xea)](JSON['parse'](_0x49760c));});}static[_0x4eafc6(0xea)](_0x3e9635){const _0x4422ba=_0x4eafc6;switch(_0x3e9635[_0x4422ba(0xd0)]){case _0x4422ba(0xf0):return this['_handleRollMessage'](_0x3e9635);case _0x4422ba(0xfd):return this['_pHandleEntityMessage'](_0x3e9635);case _0x4422ba(0xd1):return this[_0x4422ba(0x107)](_0x3e9635);case _0x4422ba(0xfb):return this['_pHandleSpecialMessage_5etools_lootgen_loot'](_0x3e9635);case _0x4422ba(0xf4):return this[_0x4422ba(0x109)](_0x3e9635);default:ui['notifications']['error'](_0x4422ba(0xcb)+_0x3e9635[_0x4422ba(0xd0)]+_0x4422ba(0xe6));}}static[_0x4eafc6(0xcc)](_0x4c6d91){const _0x3c23e8=_0x4eafc6,_0x8f26ad=_0x4c6d91[_0x3c23e8(0x111)];if(!_0x4c6d91[_0x3c23e8(0xe4)]['isSendRolls'])return;const _0x413735=new Roll(_0x8f26ad[_0x3c23e8(0x10e)]);_0x413735[_0x3c23e8(0xeb)]({'speaker':{'alias':_0x8f26ad[_0x3c23e8(0xcd)]},'flavor':_0x8f26ad[_0x3c23e8(0xf8)],'rollMode':_0x4c6d91[_0x3c23e8(0xe4)][_0x3c23e8(0xdb)]?CONST[_0x3c23e8(0xe9)][_0x3c23e8(0xe7)]:CONST['CHAT_MESSAGE_TYPES'][_0x3c23e8(0xd3)]});}static async[_0x4eafc6(0xe5)](_0x56b130){const _0x280088=_0x4eafc6,_0x4b703a=Config['get'](_0x280088(0xec),_0x280088(0xd9));if(game[_0x280088(0xf6)][_0x280088(0xce)]<_0x4b703a)return ui[_0x280088(0xfe)]['warn']('You\x20do\x20not\x20have\x20the\x20role\x20required!');const _0x2673ff=_0x56b130[_0x280088(0x111)],_0x4db5da=this[_0x280088(0xee)](),{ChooseImporter:_0x2cf481}=await import('./ChooseImporter.js'),_0x1ed1cc=_0x2cf481[_0x280088(0xe3)](_0x2673ff?.['entity']?.[_0x280088(0xe1)]||_0x2673ff[_0x280088(0xf1)],_0x4db5da);if(!_0x1ed1cc)return ui[_0x280088(0xfe)][_0x280088(0xf3)]('Plutonium\x20does\x20not\x20yet\x20support\x20entities\x20from\x20\x22'+(_0x2673ff?.['entity']?.['__prop']||_0x2673ff['page'])+_0x280088(0xe6));try{await _0x1ed1cc[_0x280088(0xfa)]();const _0x320e79={..._0x2673ff[_0x280088(0x101)]||{}};if(_0x2673ff[_0x280088(0xf5)])_0x320e79[_0x280088(0xf5)]=!![];const _0x18da84=await _0x1ed1cc['pImportEntry'](_0x2673ff[_0x280088(0xfd)],_0x320e79);UtilApplications[_0x280088(0xc8)](_0x18da84);}catch(_0x32078b){UtilApplications[_0x280088(0xc8)]({'entity':_0x2673ff,'status':UtilApplications[_0x280088(0xdd)]}),setTimeout(()=>{throw _0x32078b;});}}static async[_0x4eafc6(0x107)](_0x140cf4){const _0x32ef81=_0x4eafc6,_0x19196a=_0x140cf4['data'],_0x2363b5=this['_getTargetActor']();if(!_0x2363b5){await ChatMessage[_0x32ef81(0x103)]({'content':_0x32ef81(0xc6)+Parser[_0x32ef81(0xc5)](_0x19196a[_0x32ef81(0xd1)])+_0x32ef81(0xff),'user':game[_0x32ef81(0x10f)],'type':0x4,'speaker':{'alias':_0x32ef81(0xf7)},'whisper':game[_0x32ef81(0x104)][_0x32ef81(0x10a)][_0x32ef81(0xe0)](_0x5a9261=>_0x5a9261[_0x32ef81(0xf9)]||_0x5a9261===game[_0x32ef81(0xf6)])['map'](_0x5136c5=>_0x5136c5['id'])});return;}try{await UtilActors[_0x32ef81(0xef)]({'currency':_0x19196a[_0x32ef81(0xd1)],'actor':_0x2363b5}),ui['notifications']['info']('Applied\x20currency\x20\x22'+Parser[_0x32ef81(0xc5)](_0x19196a['currency'])+_0x32ef81(0xd4)+_0x2363b5[_0x32ef81(0x100)]+'\x22');}catch(_0xd5fd99){ui[_0x32ef81(0xfe)][_0x32ef81(0xf3)](_0x32ef81(0x108)+Parser['getDisplayCurrency'](_0x19196a[_0x32ef81(0xd1)])+_0x32ef81(0xd4)+_0x2363b5[_0x32ef81(0x100)]+'\x22'),setTimeout(()=>{throw _0xd5fd99;});}}static async['_pHandleSpecialMessage_5etools_lootgen_loot'](_0x47ca2b){const _0xb5747c=_0x4eafc6,{LootGeneratorApp:_0x5077f3}=await import(_0xb5747c(0xc7)),_0x4efdec=_0x47ca2b['data'],_0x55d479=this[_0xb5747c(0xee)]();await _0x5077f3['pImportLoot']({'loot':_0x4efdec,'actor':_0x55d479,'isLogToChat':!![],'isNotify':!![]});}static async[_0x4eafc6(0x109)](_0x930e55){const _0x2b8599=_0x4eafc6;await UtilWorldContentBlacklist[_0x2b8599(0x106)](_0x930e55['data'],{'message':'Updated\x20content\x20blacklist!'});}static[_0x4eafc6(0xee)](){const _0x31de8e=_0x4eafc6,_0x11c508=(Config[_0x31de8e(0xc4)](_0x31de8e(0xdf),'targetActorId')||'')['trim']();if(!_0x11c508)return null;const _0x27ad37=/^Scene\.(?<sceneId>[^.]+)\.Token\.(?<tokenId>[^.]+)$/[_0x31de8e(0xdc)](_0x11c508);if(!_0x27ad37)return CONFIG[_0x31de8e(0xcf)][_0x31de8e(0x114)][_0x31de8e(0x113)][_0x31de8e(0xc4)](_0x11c508);const _0x3b903a=game['scenes'][_0x31de8e(0xc4)](_0x27ad37[_0x31de8e(0x115)]['sceneId']);if(!_0x3b903a)return null;const _0x5c79c1=_0x3b903a[_0x31de8e(0xda)][_0x31de8e(0xc4)](_0x27ad37[_0x31de8e(0x115)][_0x31de8e(0x110)]);if(!_0x5c79c1)return null;return _0x5c79c1[_0x31de8e(0x10d)];}}export{RivetBridge};