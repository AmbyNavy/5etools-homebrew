const _0x103571=_0x594d;(function(_0x51731e,_0x1d79f6){const _0x57fca8=_0x594d,_0x2cdff7=_0x51731e();while(!![]){try{const _0xed6ed8=parseInt(_0x57fca8(0x17c))/0x1+parseInt(_0x57fca8(0x1d0))/0x2+-parseInt(_0x57fca8(0x151))/0x3*(parseInt(_0x57fca8(0x1af))/0x4)+-parseInt(_0x57fca8(0x167))/0x5+parseInt(_0x57fca8(0x17f))/0x6+-parseInt(_0x57fca8(0x1a2))/0x7*(parseInt(_0x57fca8(0x17a))/0x8)+parseInt(_0x57fca8(0x1d4))/0x9;if(_0xed6ed8===_0x1d79f6)break;else _0x2cdff7['push'](_0x2cdff7['shift']());}catch(_0x190e70){_0x2cdff7['push'](_0x2cdff7['shift']());}}}(_0x4419,0xd829c));import{Vetools}from'./Vetools.js';import{UtilList2}from'./UtilList2.js';import{UtilDataSource}from'./UtilDataSource.js';import{ImportList}from'./ImportList.js';import{LGT}from'./Util.js';import{UtilAdventureBook}from'./UtilAdventureBook.js';import{UtilApplications}from'./UtilApplications.js';import{UtilImage}from'./UtilImage.js';function _0x594d(_0x4379bb,_0x5ea20b){const _0x441974=_0x4419();return _0x594d=function(_0x594d33,_0x3c7e30){_0x594d33=_0x594d33-0x146;let _0x5a9a70=_0x441974[_0x594d33];return _0x5a9a70;},_0x594d(_0x4379bb,_0x5ea20b);}import{NoteImageCreator}from'./NoteImageCreator.js';import{UtilCanvas}from'./UtilCanvas.js';import{Config}from'./Config.js';class PageFilterMaps extends PageFilter{constructor(){const _0x3eb723=_0x594d;super(),this[_0x3eb723(0x1b0)]=new SourceFilter(),this['_typeFilter']=new Filter({'header':'Type','items':[_0x3eb723(0x178),'mapPlayer'],'displayFn':Parser['imageTypeToFull']});}static[_0x103571(0x153)](_0x1692ed){}['addToFilters'](_0x5e25f2,_0x279e07){const _0x290ff7=_0x103571;if(_0x279e07)return;this[_0x290ff7(0x1b0)]['addItem'](_0x5e25f2['source']),this['_typeFilter']['addItem'](_0x5e25f2[_0x290ff7(0x157)]);}async[_0x103571(0x1ba)](_0x2b2855){const _0x44ca8e=_0x103571;_0x2b2855[_0x44ca8e(0x156)]=[this[_0x44ca8e(0x1b0)],this['_typeFilter']];}[_0x103571(0x186)](_0x5b654e,_0xa7bd4a){const _0x1224df=_0x103571;return this[_0x1224df(0x1c3)]['toDisplay'](_0x5b654e,_0xa7bd4a['source'],_0xa7bd4a[_0x1224df(0x157)]);}}function _0x4419(){const _0x5a5456=['389300xicROj','getImageUrl','_pImportEntry_pImportToDirectoryGeneric','absorbFnBindListenersRadio','17765037MufSpo','hexRowsEven','get','pGetBookIndex','hexColsEven','isSceneAddToNavigation','imported','Import\x20Maps','pCreateImageGetUrl','doAbsorbItems','_getGridType','head','Cannot\x20import\x20map\x20content\x20to\x20actor!','ascSortDate','grid','513TTWpaf','_$getListPreviewStats','mutateForFilters','doProcessNode_mutAddMaps','length','filters','imageType','_pImportEntry_pImportToDirectoryGeneric_pGetImportableData','pOptionallySaveImageToServerAndGetUrl','adventure','none','mutMapNames','type','scaleAuto','sourceJsonToAbv','getCentroid','size','_list','_isRadio','getMetricUnitDistance','values','_pGetMapScene','2580165ioBDmV','bind','TASK_EXIT_SKIPPED_DUPLICATE','DataSourceFile','_page','_pGetSources','join','offsetX','book','pGetAdventureIndex','_activateListeners_absorbListItems','push','Note','filter','height','_getPuckName','round','map','scaleX','244232XvOHTR','bindPreviewButton','1187392wlItpX','isSceneGridMetric','units','162858uInkng','getWalker','entryIdToJournalId','Custom\x20URL','update','split','Type','toDisplay','thumb','_pPostLoadOther','(Unnamed\x20Chapter)','_pubDate','PG_MAPS','getMetricNumberDistance','area','_pImportScene_pFillScene','constructor','bookData','Importing\x20map\x20\x22','SOURCE_TYP_CUSTOM','isSceneFogExploration','source','naturalWidth','imageTypeToFull','log','getFolderPathMeta','DataSourceUrl','_actor','createThumbnail','hover','importMap','mapRegions','_getGridSize','_getGridDistance','hexColsOdd','336TSvWyy','pLoadImage','forEach','_parentEntry','distance','naturalHeight','isStatic','maps','createEmbeddedDocuments','ceil','SOURCE_TYP_OFFICIAL_SINGLE','_pGetMapRegionPoints','scenes','12076Cpliqg','_sourceFilter','$getHoverContent_stats','_getGridOffsetY','Scene','_getGridOffsetX','FOLDER_TYPE','offsetY','width','Chapter\x20Name','contents','_pPopulateBoxOptions','_chapterName','scenePadding','_content','_pPostLoadShared','absorbFnBindListeners','ascSortLower','status','_pPostLoadVetools','_filterBox','registerImpl','name','Maps','sceneBackgroundColor','DISPLAY_NAME_TYPE_PLURAL','points','Upload\x20File','_getGridUnits','data','mapParent','sort','_pImportEntry'];_0x4419=function(){return _0x5a5456;};return _0x4419();}class ImportListMap extends ImportList{static ['ID']=_0x103571(0x1a9);static [_0x103571(0x1c8)]=_0x103571(0x1c6);static ['_']=this[_0x103571(0x1c4)](this);static get[_0x103571(0x1b5)](){const _0x5c2cbd=_0x103571;return _0x5c2cbd(0x1b3);}constructor(_0x53daef){const _0x22ba26=_0x103571;_0x53daef=_0x53daef||{},super({'title':_0x22ba26(0x149)},_0x53daef,{'titleSearch':_0x22ba26(0x1a9),'defaultFolderPath':[],'dirsHomebrew':[_0x22ba26(0x15a),'book'],'namespace':_0x22ba26(0x178),'configGroup':'importMap','sidebarTab':_0x22ba26(0x1ae),'gameProp':_0x22ba26(0x1ae),'pageFilter':new PageFilterMaps(),'page':UrlUtil[_0x22ba26(0x18b)],'isPreviewable':!![]});}async[_0x103571(0x16c)](){const _0x5d67a3=_0x103571,_0x577bae=await Vetools[_0x5d67a3(0x170)](),_0xafc7e3=await Vetools[_0x5d67a3(0x1d7)](),_0x4cd2d1=[..._0x577bae[_0x5d67a3(0x15a)],..._0xafc7e3[_0x5d67a3(0x16f)]][_0x5d67a3(0x1ce)]((_0x376e40,_0x1fcc59)=>SortUtil[_0x5d67a3(0x14f)](_0x1fcc59[_0x5d67a3(0x18a)],_0x376e40[_0x5d67a3(0x18a)])||SortUtil[_0x5d67a3(0x1c0)](_0x376e40[_0x5d67a3(0x1c5)],_0x1fcc59[_0x5d67a3(0x1c5)]));return[..._0x4cd2d1[_0x5d67a3(0x178)](_0x1e32aa=>new UtilDataSource[(_0x5d67a3(0x199))](_0x1e32aa[_0x5d67a3(0x1c5)],_0x1e32aa['_url'],{'pPostLoad':this[_0x5d67a3(0x1c2)]['bind'](this),'userData':_0x1e32aa,'filterTypes':[UtilDataSource[_0x5d67a3(0x1ac)]],'source':_0x1e32aa[_0x5d67a3(0x194)]})),new UtilDataSource['DataSourceUrl'](_0x5d67a3(0x182),'',{'pPostLoad':this[_0x5d67a3(0x188)][_0x5d67a3(0x168)](this),'filterTypes':[UtilDataSource[_0x5d67a3(0x192)]]}),new UtilDataSource[(_0x5d67a3(0x16a))](_0x5d67a3(0x1ca),{'pPostLoad':this['_pPostLoadOther'][_0x5d67a3(0x168)](this),'filterTypes':[UtilDataSource[_0x5d67a3(0x192)]]}),...await this['_pGetSourcesHomebrew']({'pPostLoad':this['_pPostLoadOther'][_0x5d67a3(0x168)](this)})];}[_0x103571(0x1c2)](_0x1f7aba,_0x30185b,_0x2084cb){return this['_pPostLoadShared']({'head':_0x2084cb,'body':_0x1f7aba});}['_pPostLoadOther'](_0x16b1fe){const _0x36fb3a=_0x103571;return[{'propData':'adventureData','prop':_0x36fb3a(0x15a)},{'propData':_0x36fb3a(0x190),'prop':'book'}]['map'](({prop:_0xf2595c,propData:_0x5f557d})=>{const _0x556c2b=_0x36fb3a;if(!_0x16b1fe[_0xf2595c]||!_0x16b1fe[_0x5f557d])return null;const _0xb99159=_0x16b1fe[_0xf2595c][_0x556c2b(0x178)](_0x23e82=>{const _0x5ba376=_0x16b1fe[_0x5f557d]['find'](_0x1ef285=>_0x1ef285['id']===_0x23e82['id']);if(!_0x5ba376)return null;return{'head':_0x23e82,'body':_0x5ba376};})[_0x556c2b(0x174)](Boolean);return _0xb99159[_0x556c2b(0x178)](_0x846113=>this[_0x556c2b(0x1be)]({'head':_0x846113[_0x556c2b(0x14d)],'body':_0x846113['body']}));})[_0x36fb3a(0x174)](Boolean)['flat'](0x2);}[_0x103571(0x1be)]({body:_0xb5254a,head:_0x2e5403}){const _0x19b87c=_0x103571,_0x2d8c62=[],_0x5f53b2={},_0x677712={},_0x203b87={},_0x438cd5=MiscUtil[_0x19b87c(0x180)]({'isNoModification':!![]});return _0xb5254a[_0x19b87c(0x1cc)][_0x19b87c(0x1a4)]((_0x1d2315,_0x3ca307)=>{_0x438cd5['walk'](_0x1d2315,{'object':(_0x561c4d,_0x59891d,_0x54bcde)=>{const _0x331af5=_0x594d;return UtilAdventureBook[_0x331af5(0x154)]({'availableMaps':_0x5f53b2,'entryIdToMap':_0x677712,'entryIdToName':_0x203b87,'entry':_0x561c4d,'entryStack':_0x54bcde,'source':_0x2e5403[_0x331af5(0x194)],'chapterInfo':_0x2e5403[_0x331af5(0x1b9)]?.[_0x3ca307]}),_0x561c4d;}});}),UtilAdventureBook[_0x19b87c(0x15c)]({'availableMaps':_0x5f53b2,'entryIdToMap':_0x677712,'entryIdToName':_0x203b87}),Object[_0x19b87c(0x165)](_0x5f53b2)[_0x19b87c(0x1a4)](_0x4898bb=>{const _0x21f449=_0x19b87c;Object[_0x21f449(0x165)](_0x4898bb)[_0x21f449(0x1a4)](_0x297b6d=>{_0x2d8c62['push'](_0x297b6d);});}),_0x2d8c62;}[_0x103571(0x171)](){const _0x189885=_0x103571;this[_0x189885(0x162)][_0x189885(0x14b)](this[_0x189885(0x1bd)],{'fnGetName':_0x5635ca=>_0x5635ca[_0x189885(0x1c5)],'fnGetValues':_0x4b74ee=>({'type':_0x4b74ee[_0x189885(0x157)],'source':_0x4b74ee[_0x189885(0x194)]}),'fnGetData':UtilList2['absorbFnGetData'],'fnBindListeners':_0x13d8d0=>this[_0x189885(0x163)]?UtilList2[_0x189885(0x1d3)](this['_list'],_0x13d8d0):UtilList2[_0x189885(0x1bf)](this[_0x189885(0x162)],_0x13d8d0)});}[_0x103571(0x198)](){const _0x271aed=_0x103571;return{...super[_0x271aed(0x198)](),'chapterName':{'label':_0x271aed(0x1b8),'getter':_0x4b5a6e=>_0x4b5a6e[_0x271aed(0x1bb)]||_0x271aed(0x189)},'type':{'label':_0x271aed(0x185),'getter':_0xbc3e3d=>Parser[_0x271aed(0x196)](_0xbc3e3d[_0x271aed(0x157)])}};}async[_0x103571(0x1cf)](_0x3fcd8f,_0x4b1504){const _0x4beab9=_0x103571;_0x4b1504=_0x4b1504||{},console[_0x4beab9(0x197)](...LGT,_0x4beab9(0x191)+_0x3fcd8f[_0x4beab9(0x1c5)]+'\x22\x20(from\x20\x22'+Parser[_0x4beab9(0x15f)](_0x3fcd8f[_0x4beab9(0x194)])+'\x22)');if(this[_0x4beab9(0x19a)])throw new Error(_0x4beab9(0x14e));const _0x2c6c0=await this[_0x4beab9(0x1d2)](_0x3fcd8f,_0x4b1504);if(_0x2c6c0[_0x4beab9(0x1c1)]===UtilApplications[_0x4beab9(0x169)])return _0x2c6c0;const _0x10382c=_0x2c6c0[_0x4beab9(0x148)]?.[0x0]?.['document'];if(!_0x10382c)return _0x2c6c0;const _0x5d3f6c=await _0x10382c[_0x4beab9(0x19b)]();return await _0x10382c[_0x4beab9(0x183)]({'thumb':_0x5d3f6c[_0x4beab9(0x187)]},{'diff':![]}),await this[_0x4beab9(0x18e)]({'entry':_0x3fcd8f,'entryIdToJournalId':_0x4b1504[_0x4beab9(0x181)],'scene':_0x10382c}),_0x2c6c0;}async[_0x103571(0x158)](_0x18e9eb,_0x41a3f9){return this['_pGetMapScene']({'entry':_0x18e9eb});}async[_0x103571(0x166)]({entry:_0x3e44fd}){const _0x42a511=_0x103571;let _0x23f0ec=Vetools[_0x42a511(0x1d1)](_0x3e44fd);_0x23f0ec=await Vetools[_0x42a511(0x159)](_0x23f0ec);const {width:_0x2ebf54,height:_0x4bea8a}=await this[_0x42a511(0x18f)]['_pGetImageDimensions']({'entry':_0x3e44fd,'url':_0x23f0ec});return{'name':_0x3e44fd[_0x42a511(0x1c5)],'active':![],'navigation':Config[_0x42a511(0x1d6)](_0x42a511(0x19d),_0x42a511(0x147)),'img':encodeURL(_0x23f0ec),'width':Math[_0x42a511(0x177)](_0x2ebf54),'height':Math[_0x42a511(0x177)](_0x4bea8a),'padding':Config['get'](_0x42a511(0x19d),_0x42a511(0x1bc)),'backgroundColor':Config['get']('importMap',_0x42a511(0x1c7)),'tokenVision':Config[_0x42a511(0x1d6)](_0x42a511(0x19d),'isSceneTokenVision'),'fogExploration':Config[_0x42a511(0x1d6)](_0x42a511(0x19d),_0x42a511(0x193)),'gridDistance':this['_getGridDistance']({'entry':_0x3e44fd}),'gridUnits':this[_0x42a511(0x1cb)]({'entry':_0x3e44fd}),'grid':this['_getGridSize']({'entry':_0x3e44fd}),'shiftX':this[_0x42a511(0x1b4)]({'entry':_0x3e44fd}),'shiftY':this[_0x42a511(0x1b2)]({'entry':_0x3e44fd}),'gridType':this[_0x42a511(0x14c)]({'entry':_0x3e44fd})};}[_0x103571(0x1a0)]({entry:_0x583b94}){const _0x15f861=_0x103571,_0x372b72=_0x583b94[_0x15f861(0x150)]?.[_0x15f861(0x1a6)]??0x5,_0x396c7f=_0x583b94[_0x15f861(0x150)]?.[_0x15f861(0x17e)]??'ft';return Config[_0x15f861(0x18c)]({'configGroup':'importMap','originalValue':_0x372b72,'originalUnit':_0x396c7f,'configKey':_0x15f861(0x17d)});}[_0x103571(0x1cb)]({entry:_0x28200a}){const _0x51f15b=_0x103571,_0x2cd29e=_0x28200a[_0x51f15b(0x150)]?.[_0x51f15b(0x17e)]??'ft';return Config[_0x51f15b(0x164)]({'configGroup':_0x51f15b(0x19d),'originalUnit':_0x2cd29e,'configKey':'isSceneGridMetric'});}[_0x103571(0x19f)]({entry:_0x36e1b2}){const _0x9734f2=_0x103571;return _0x36e1b2['grid']?.[_0x9734f2(0x161)]??0x64;}[_0x103571(0x1b4)]({entry:_0x275c9}){const _0x4c95b5=_0x103571;return _0x275c9['grid']?.[_0x4c95b5(0x16e)]??0x0;}[_0x103571(0x1b2)]({entry:_0x404371}){return _0x404371['grid']?.['offsetY']??0x0;}[_0x103571(0x14c)]({entry:_0x25dd0c}){const _0x49b37f=_0x103571;if(!_0x25dd0c[_0x49b37f(0x150)]?.[_0x49b37f(0x15d)])return 0x1;switch(_0x25dd0c['grid']['type']){case _0x49b37f(0x15b):return 0x0;case'square':return 0x1;case'hexRowsOdd':return 0x2;case _0x49b37f(0x1d5):return 0x3;case _0x49b37f(0x1a1):return 0x4;case _0x49b37f(0x146):return 0x5;default:throw new Error('Unknown\x20image\x20grid\x20type:\x20\x22'+_0x25dd0c[_0x49b37f(0x150)][_0x49b37f(0x15d)]+'\x22');}}static async['_pGetImageDimensions']({entry:_0x117302,url:_0x1e37d8}){const _0x35352d=_0x103571;if(_0x117302[_0x35352d(0x1b7)]&&_0x117302[_0x35352d(0x175)])return{'width':_0x117302[_0x35352d(0x1b7)],'height':_0x117302[_0x35352d(0x175)]};const _0x2de27c=await UtilImage[_0x35352d(0x1a3)](_0x1e37d8);return{'width':_0x2de27c[_0x35352d(0x195)],'height':_0x2de27c[_0x35352d(0x1a7)]};}async['_pImportScene_pFillScene']({entry:_0x28397e,entryIdToJournalId:_0x4a45d3,scene:_0x48bcc3}){const _0x4218f9=_0x103571,_0x51be48=_0x28397e[_0x4218f9(0x1a5)],_0x45f970=_0x28397e[_0x4218f9(0x19e)]||_0x51be48?.[_0x4218f9(0x19e)];if(!_0x45f970?.[_0x4218f9(0x155)])return;const _0x3629da=_0x48bcc3[_0x4218f9(0x1cc)][_0x4218f9(0x1b7)],_0x134568=_0x48bcc3[_0x4218f9(0x1cc)][_0x4218f9(0x175)],_0x5c9950=[];for(const _0x4b9866 of _0x45f970){if(!_0x4b9866[_0x4218f9(0x18d)]||!_0x4b9866[_0x4218f9(0x1c9)]?.['length'])continue;const _0x2b707f=_0x4a45d3?.[_0x4b9866[_0x4218f9(0x18d)]];if(!_0x2b707f)continue;const _0x499cd5=_0x4b9866[_0x4218f9(0x1c5)]||'-',_0xe5e4b3=this[_0x4218f9(0x18f)][_0x4218f9(0x176)]({'name':_0x499cd5}),_0x3971d8=await NoteImageCreator[_0x4218f9(0x14a)]({'name':_0xe5e4b3}),_0x1ff166=await this['constructor'][_0x4218f9(0x1ad)]({'mapRegion':_0x4b9866,'entry':_0x28397e,'imageWidth':_0x3629da,'imageHeight':_0x134568,'parentEntry':_0x51be48}),_0x1874a8=UtilCanvas[_0x4218f9(0x160)](_0x1ff166);_0x5c9950[_0x4218f9(0x172)]({'entryId':_0x2b707f,'icon':_0x3971d8,'iconSize':Math[_0x4218f9(0x1ab)]((_0x48bcc3[_0x4218f9(0x1cc)]?.['grid']??0x64)/0x2),'text':_0x499cd5,'x':_0x1874a8[0x0]+(_0x28397e[_0x4218f9(0x150)]?.[_0x4218f9(0x16e)]||0x0),'y':_0x1874a8[0x1]+(_0x28397e[_0x4218f9(0x150)]?.[_0x4218f9(0x1b6)]||0x0)});}await _0x48bcc3[_0x4218f9(0x1aa)](_0x4218f9(0x173),_0x5c9950);}static[_0x103571(0x176)]({name:_0x2d58e5}){const _0x2bbf3d=_0x103571,_0xab2e01=_0x2d58e5[_0x2bbf3d(0x184)](/[.;:!]/g);return _0xab2e01[_0x2bbf3d(0x155)]===0x1?_0xab2e01[0x0]['replace'](/[()"']/g,'')['split'](/ /g)['map'](_0x7b9026=>_0x7b9026[0x0])[_0x2bbf3d(0x16d)]('.'):_0xab2e01[0x0];}static async['_pGetMapRegionPoints']({mapRegion:_0x3c1741,entry:_0x4beaf5,imageWidth:_0x2ac3c9,imageHeight:_0xbd2de2,parentEntry:_0x3c8486}){const _0x2d7a64=_0x103571;if(!_0x3c8486)return _0x3c1741['points'];const _0x39ebfd=Vetools[_0x2d7a64(0x1d1)](_0x3c8486),{width:_0x1ac766,height:_0x1d7355}=await this['_pGetImageDimensions']({'entry':_0x3c8486,'url':_0x39ebfd}),_0x314a79=_0x4beaf5[_0x2d7a64(0x1cd)][_0x2d7a64(0x16e)]||0x0,_0x1c6e82=_0x4beaf5[_0x2d7a64(0x1cd)][_0x2d7a64(0x1b6)]||0x0,_0x267287=_0x4beaf5[_0x2d7a64(0x1cd)][_0x2d7a64(0x179)]??(_0x4beaf5[_0x2d7a64(0x1cd)][_0x2d7a64(0x15e)]?_0x1ac766/_0x2ac3c9:0x1),_0x324ef4=_0x4beaf5[_0x2d7a64(0x1cd)]['scaleY']??(_0x4beaf5[_0x2d7a64(0x1cd)][_0x2d7a64(0x15e)]?_0x1d7355/_0xbd2de2:0x1);return _0x3c1741[_0x2d7a64(0x1c9)][_0x2d7a64(0x178)](([_0x4b3271,_0x52b29b])=>{const _0x2816c6=_0x2d7a64;return[Math[_0x2816c6(0x177)](_0x4b3271*(0x1/_0x267287)+_0x314a79),Math[_0x2816c6(0x177)](_0x52b29b*(0x1/_0x324ef4)+_0x1c6e82)];});}['_$getListPreviewStats'](_0x4833ca,_0x22832a,_0x5bfb6f){const _0x20f535=_0x103571;return Renderer[_0x20f535(0x19c)][_0x20f535(0x1b1)]('generic',_0x22832a,{'isBookContent':!![],'isStatic':_0x5bfb6f[_0x20f535(0x1a8)]});}['_activateListeners_initPreviewButton'](_0x44c2f1,_0x172976){const _0x102fe1=_0x103571;ListUiUtil[_0x102fe1(0x17b)](this[_0x102fe1(0x16b)],this[_0x102fe1(0x1bd)],_0x44c2f1,_0x172976,{'$fnGetPreviewStats':this[_0x102fe1(0x152)][_0x102fe1(0x168)](this)});}}export{ImportListMap};